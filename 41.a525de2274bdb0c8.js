"use strict";(self.webpackChunkmiuform=self.webpackChunkmiuform||[]).push([[41],{4041:(Ct,G,a)=>{a.r(G),a.d(G,{ReportsModule:()=>D});var h=a(6895),v=a(9132),l=a(4006),R=a(8505),C=a(5577),Z=a(4004),q=a(7188),O=a(590),Q=a(9646),A=a(7274),t=a(4650),y=a(4859),E=a(4463);class b{constructor(o,e){this.dialogRef=o,this.data=e,this.title=e.title,this.message=e.message}ngOnInit(){}onConfirm(){this.dialogRef.close(!0)}onDismiss(){this.dialogRef.close(!1)}static#t=this.\u0275fac=function(e){return new(e||b)(t.Y36(A.so),t.Y36(A.WI))};static#e=this.\u0275cmp=t.Xpm({type:b,selectors:[["app-confirm-dialog"]],decls:12,vars:8,consts:[["mat-dialog-title",""],["mat-dialog-content",""],["mat-dialog-actions",""],["mat-button","",3,"click"],["mat-raised-button","","color","primary",3,"click"]],template:function(e,r){1&e&&(t.TgZ(0,"h1",0),t._uU(1),t.qZA(),t.TgZ(2,"div",1)(3,"p"),t._uU(4),t.qZA()(),t.TgZ(5,"div",2)(6,"button",3),t.NdJ("click",function(){return r.onDismiss()}),t._uU(7),t.ALo(8,"translate"),t.qZA(),t.TgZ(9,"button",4),t.NdJ("click",function(){return r.onConfirm()}),t._uU(10),t.ALo(11,"translate"),t.qZA()()),2&e&&(t.xp6(1),t.hij(" ",r.title,"\n"),t.xp6(3),t.Oqu(r.message),t.xp6(3),t.Oqu(t.lcZ(8,4,"COMMON.NO")),t.xp6(3),t.Oqu(t.lcZ(11,6,"COMMON.YES")))},dependencies:[y.lW,A.uh,A.xY,A.H8,E.X$],styles:["div[mat-dialog-actions][_ngcontent-%COMP%]{justify-content:end}"]})}class K{constructor(o,e){this.title=o,this.message=e}}var $=a(1042);class M{constructor(){this.pointImages=[]}static Create(o){let e=new M;return e.checklistItemId=o._id,e.content=o.content,e.order=o.order,e.isChecked=null,e}}var w=a(1011),g=a(3546),U=a(7392),S=a(4144),k=a(9549),z=a(1572),Y=a(4385),H=a(3238),X=a(1481);const V=function(n){return{"border-width":n}};function W(n,o){if(1&n){const e=t.EpF();t.TgZ(0,"div",7)(1,"div",8),t.NdJ("click",function(){const s=t.CHM(e).$implicit,c=t.oxw();return t.KtG(c.selectImage(s))}),t._UZ(2,"img",9),t.qZA()()}if(2&n){const e=o.$implicit,r=o.index,i=t.oxw();let s;t.Q6J("ngStyle",t.VKq(4,V,!0===(null==(s=e.get("selected"))?null:s.value)?"4px":"1px"))("formArrayName",i.imagesFormArrayName),t.xp6(1),t.Q6J("formGroupName",r),t.xp6(1),t.Q6J("src",i.blobToSrc(e.get("blob").value),t.LSH)}}class x{constructor(o){this.domSanitizer=o,this.onFileInput=e=>{console.log("aaa"),e.target.files&&e.target.files.length>0&&(0,q.$)(Array.from(e.target.files).map(r=>this.resizeImage(r,1200,1200))).subscribe({next:r=>{console.log(r),r.forEach(i=>this.imagesFormArray.push(new l.cw({selected:new l.NI(!1),blob:new l.NI(i.blob),size:new l.NI(i.size)}))),console.log(this.imagesFormArray)},error:r=>{console.error(r)}})}}ngOnInit(){}get selectedImages(){return(this.imagesFormArray.controls??[]).map(o=>o).filter(o=>o&&!0===o.get("selected").value)}selectImage(o){const e=o,r=e.get("selected").value??!1;e.get("selected").setValue(!r)}deleteSelected(){this.selectedImages.forEach(o=>{const e=this.imagesFormArray.controls.indexOf(o,0);e>-1&&this.imagesFormArray.controls.splice(e,1)})}blobToSrc(o){return console.log("blobToSrc: "+o),this.domSanitizer.bypassSecurityTrustUrl(URL.createObjectURL(o))}getScale(o,e,r){if(o.width<=e&&o.height<=r)return{width:o.width,height:o.height};let i,s;return o.width>o.height?(s=o.height*(e/o.width),i=e):(i=o.width*(r/o.height),s=r),{width:i,height:s}}resizeImage(o,e,r){return new Promise((i,s)=>{let c=new Image;c.src=URL.createObjectURL(o),c.onload=()=>{let T,_,p=c.width,u=c.height;p<=e&&u<=r&&i({blob:o,size:{width:p,height:u}}),p>u?(_=u*(e/p),T=e):(T=p*(r/u),_=r);let F=document.createElement("canvas");F.width=T,F.height=_,F.getContext("2d").drawImage(c,0,0,T,_),F.toBlob(d=>{i({blob:d,size:{width:T,height:_}})},o.type)},c.onerror=s})}static#t=this.\u0275fac=function(e){return new(e||x)(t.Y36(X.H7))};static#e=this.\u0275cmp=t.Xpm({type:x,selectors:[["app-images-selector"]],inputs:{parentImagesFormGroup:"parentImagesFormGroup",imagesFormArrayName:"imagesFormArrayName",imagesFormArray:"imagesFormArray"},decls:11,vars:3,consts:[[2,"display","flex","flex-direction","row","gap","5px"],["mat-fab","","color","primary",3,"click"],["type","file","accept","image/x-png,image/jpeg,image/gif","multiple","multiple",2,"display","none",3,"change"],["fileInput",""],["mat-fab","","color","warn",3,"disabled","click"],[2,"display","flex","flex-direction","row","flex-flow","wrap",3,"formGroup"],["style","margin: 3px; border: 1px solid black",3,"ngStyle","formArrayName",4,"ngFor","ngForOf"],[2,"margin","3px","border","1px solid black",3,"ngStyle","formArrayName"],[2,"width","200px","height","200px","display","flex","justify-content","center",3,"formGroupName","click"],[2,"display","block","max-width","200px","max-height","200px","width","auto","height","auto","margin","auto",3,"src"]],template:function(e,r){if(1&e){const i=t.EpF();t.TgZ(0,"div",0)(1,"button",1),t.NdJ("click",function(){t.CHM(i);const c=t.MAs(5);return t.KtG(c.click())}),t.TgZ(2,"mat-icon"),t._uU(3,"library_add"),t.qZA(),t.TgZ(4,"input",2,3),t.NdJ("change",function(c){return r.onFileInput(c)}),t.qZA()(),t.TgZ(6,"button",4),t.NdJ("click",function(){return r.deleteSelected()}),t.TgZ(7,"mat-icon"),t._uU(8,"delete"),t.qZA()()(),t.TgZ(9,"div",5),t.YNc(10,W,3,6,"div",6),t.qZA()}2&e&&(t.xp6(6),t.Q6J("disabled",0===r.selectedImages.length),t.xp6(3),t.Q6J("formGroup",r.parentImagesFormGroup),t.xp6(1),t.Q6J("ngForOf",null==r.imagesFormArray?null:r.imagesFormArray.controls))},dependencies:[h.sg,h.PC,y.cs,U.Hw,l.JL,l.sg,l.x0,l.CE]})}const tt=function(n,o,e){return{positive:n,negative:o,notChoose:e}},et=function(n,o){return{hasDetails:n,doesNotHaveDetails:o}},ot=function(n){return{display:n}};class P{constructor(){}ngOnInit(){console.log("checklist item init"),this.detailsShown=this.hasDetails}get hasDetails(){return this.pointImages.controls.length>0||this.comment?.length>0}get pointImages(){return this.checklistItemFormGroup.get("pointImages")}get comment(){return this.checklistItemFormGroup.get("comment").value}get isChecked(){return this.checklistItemFormGroup.get("isChecked").value}set isChecked(o){this.checklistItemFormGroup.get("isChecked").setValue(o)}onClickChecked(){null===this.isChecked?this.isChecked=!1:!1===this.isChecked?this.isChecked=!0:!0===this.isChecked&&(this.isChecked=null)}showDetails(o){this.detailsShown=!this.detailsShown,o.stopPropagation()}static#t=this.\u0275fac=function(e){return new(e||P)};static#e=this.\u0275cmp=t.Xpm({type:P,selectors:[["app-checklist-item"]],inputs:{checklistItemFormGroup:"checklistItemFormGroup"},decls:17,vars:23,consts:[[3,"formGroup"],[2,"display","flex","flex-direction","row","flex-grow","1","gap","5px","min-height","50px",3,"click"],[2,"flex","0 0 40px","transform","scale(1.7)",3,"ngClass"],[2,"flex","1"],[2,"flex","0 0 40px","transform","scale(1.7)","margin-left","auto",3,"ngClass","click"],[3,"ngStyle"],[2,"width","100%"],["matInput","","formControlName","comment",3,"placeholder"],["imagesFormArrayName","pointImages",3,"imagesFormArray","parentImagesFormGroup"]],template:function(e,r){1&e&&(t.TgZ(0,"mat-card",0)(1,"mat-card-header")(2,"div",1),t.NdJ("click",function(){return r.onClickChecked()}),t.TgZ(3,"mat-icon",2),t._uU(4,"check_circle"),t.qZA(),t.TgZ(5,"h4",3),t._uU(6),t.qZA(),t.TgZ(7,"mat-icon",4),t.NdJ("click",function(s){return r.showDetails(s)}),t._uU(8,"assistant"),t.qZA()()(),t.TgZ(9,"mat-card-content",5)(10,"mat-form-field",6)(11,"mat-label"),t._uU(12),t.ALo(13,"translate"),t.qZA(),t._UZ(14,"input",7),t.ALo(15,"translate"),t.qZA(),t._UZ(16,"app-images-selector",8),t.qZA()()),2&e&&(t.Q6J("formGroup",r.checklistItemFormGroup),t.xp6(3),t.Q6J("ngClass",t.kEZ(14,tt,!0===r.isChecked,!1===r.isChecked,null===r.isChecked)),t.xp6(3),t.AsE("",r.checklistItemFormGroup.get("order").value+1,". ",r.checklistItemFormGroup.get("content").value,""),t.xp6(1),t.Q6J("ngClass",t.WLB(18,et,r.hasDetails,!r.hasDetails)),t.xp6(2),t.Q6J("ngStyle",t.VKq(21,ot,r.detailsShown?"block":"none")),t.xp6(3),t.Oqu(t.lcZ(13,10,"ITEM.CHECKLISTITEM.COMMENT")),t.xp6(2),t.s9C("placeholder",t.lcZ(15,12,"ITEM.CHECKLISTITEM.COMMENT")),t.xp6(2),t.Q6J("imagesFormArray",r.pointImages)("parentImagesFormGroup",r.checklistItemFormGroup))},dependencies:[h.mk,h.PC,g.a8,g.dn,g.dk,U.Hw,S.Nt,k.KE,k.hX,l.Fj,l.JJ,l.JL,l.sg,l.u,x,E.X$],styles:[".negative[_ngcontent-%COMP%]{color:red}.positive[_ngcontent-%COMP%]{color:green}.notChoose[_ngcontent-%COMP%]{color:#000}.hasDetails[_ngcontent-%COMP%]{color:orange}.doesNotHaveDetails[_ngcontent-%COMP%]{color:#00f}"]})}function rt(n,o){1&n&&t._UZ(0,"mat-spinner")}function it(n,o){if(1&n&&(t.TgZ(0,"mat-option",15),t._uU(1),t.qZA()),2&n){const e=o.$implicit;t.Q6J("value",e._id),t.xp6(1),t.hij(" ",e.shortName,"")}}function nt(n,o){if(1&n&&(t.TgZ(0,"div"),t._UZ(1,"app-checklist-item",16),t.qZA()),2&n){const e=o.$implicit;t.xp6(1),t.Q6J("checklistItemFormGroup",e)}}function st(n,o){if(1&n){const e=t.EpF();t.TgZ(0,"div")(1,"form",1)(2,"mat-form-field")(3,"mat-label"),t._uU(4),t.ALo(5,"translate"),t.qZA(),t._UZ(6,"input",2),t.ALo(7,"translate"),t.qZA(),t.TgZ(8,"mat-form-field")(9,"mat-label"),t._uU(10),t.ALo(11,"translate"),t.qZA(),t._UZ(12,"input",3),t.ALo(13,"translate"),t.qZA(),t.TgZ(14,"mat-form-field")(15,"mat-label"),t._uU(16),t.ALo(17,"translate"),t.qZA(),t._UZ(18,"input",4),t.ALo(19,"translate"),t.qZA(),t.TgZ(20,"mat-form-field")(21,"mat-select",5),t.ALo(22,"translate"),t.YNc(23,it,2,2,"mat-option",6),t.qZA()(),t.TgZ(24,"div",7),t.YNc(25,nt,2,1,"div",8),t.qZA(),t.TgZ(26,"mat-card",9)(27,"mat-card-header"),t._uU(28),t.ALo(29,"translate"),t.qZA(),t.TgZ(30,"mat-card-content"),t._UZ(31,"app-images-selector",10),t.TgZ(32,"mat-form-field",11)(33,"mat-label"),t._uU(34),t.ALo(35,"translate"),t.qZA(),t._UZ(36,"input",12),t.ALo(37,"translate"),t.qZA()()()(),t.TgZ(38,"button",13),t.NdJ("click",function(){t.CHM(e);const i=t.oxw();return t.KtG(i.saveReport())}),t.TgZ(39,"mat-icon"),t._uU(40,"save"),t.qZA()(),t.TgZ(41,"button",14),t.NdJ("click",function(){t.CHM(e);const i=t.oxw();return t.KtG(i.preview())}),t.TgZ(42,"mat-icon"),t._uU(43,"rebase_edit"),t.qZA()()()}if(2&n){const e=t.oxw();t.xp6(1),t.Q6J("formGroup",e.itemForm),t.xp6(3),t.Oqu(t.lcZ(5,18,"ITEM.REPORT.PRODUCT_NAME")),t.xp6(2),t.s9C("placeholder",t.lcZ(7,20,"ITEM.REPORT.PRODUCT_NAME")),t.xp6(4),t.Oqu(t.lcZ(11,22,"ITEM.REPORT.PRODUCT_COLOR")),t.xp6(2),t.s9C("placeholder",t.lcZ(13,24,"ITEM.REPORT.PRODUCT_COLOR")),t.xp6(4),t.Oqu(t.lcZ(17,26,"ITEM.REPORT.PRODUCT_ID")),t.xp6(2),t.s9C("placeholder",t.lcZ(19,28,"ITEM.REPORT.PRODUCT_ID")),t.xp6(3),t.s9C("placeholder",t.lcZ(22,30,"ITEM.REPORT.FACTORY")),t.xp6(2),t.Q6J("ngForOf",e.factoryItems),t.xp6(1),t.Q6J("formGroup",e.itemForm),t.xp6(1),t.Q6J("ngForOf",e.checklistItemFormGroups),t.xp6(3),t.hij(" ",t.lcZ(29,32,"PREPARE_REPORT.SUMMARY")," "),t.xp6(3),t.Q6J("imagesFormArray",e.images)("parentImagesFormGroup",e.itemForm),t.xp6(3),t.Oqu(t.lcZ(35,34,"ITEM.REPORT.COMMENT")),t.xp6(2),t.s9C("placeholder",t.lcZ(37,36,"ITEM.REPORT.COMMENT")),t.xp6(2),t.Q6J("disabled",!e.itemForm.valid),t.xp6(3),t.Q6J("disabled",!e.itemForm.valid)}}function at(n,o){1&n&&(t.TgZ(0,"div")(1,"p"),t._uU(2,"Raport nie istnieje."),t.qZA()())}var f=(()=>{return(n=f||(f={}))[n.ADDED=0]="ADDED",n[n.REMOVED=1]="REMOVED",n[n.CHANGED=2]="CHANGED",f;var n})();class N{constructor(o,e,r,i,s,c,p){this.formBuilder=o,this.translateService=e,this.logger=r,this.router=i,this.dialog=s,this.activatedRoute=c,this.reportService=p,this.item=void 0,this.factoryItems=[],this.checklistItems=[],this.loading=!1}ngOnInit(){this.loading=!0,this.reportService.getChecklist().pipe((0,R.b)(o=>this.checklistItems=o),(0,C.z)(o=>this.activatedRoute.params),(0,Z.U)(o=>o.id),(0,C.z)(o=>(this.logger.debug(`prepare report for id: ${o}`),void 0!==o&&""!==o?this.reportService.getReport(o).pipe((0,C.z)(e=>{const r=this.compareChecklist(e.checklist,this.checklistItems);return console.log(JSON.stringify(r)),r.length>0?(0,q.$)(this.translateService.get("PREPARE_REPORT.UPDATE_CHECKLIST_QUESTION_TITLE"),this.translateService.get("PREPARE_REPORT.UPDATE_CHECKLIST_QUESTION")).pipe((0,C.z)(i=>{const s=new K(i[0],i[1]);return this.dialog.open(b,{maxWidth:"400px",data:s}).afterClosed()}),(0,Z.U)(i=>(!0===i&&(e.checklist=this.updateChecklist(e.checklist,r,this.checklistItems)),e)),(0,Z.U)(i=>this.reportService.updateReport(i)),(0,C.z)(i=>this.reportService.getReport(o)),(0,O.P)()):(0,Q.of)(e)})):(0,Q.of)((n=>{let o={};return o._id=`report_${$.Z()}`,o.isActive=!0,o.checklist=n.map(e=>M.Create(e)),o.dateOfCreation=Date.now(),o.images=[],o})(this.checklistItems)))),(0,R.b)(o=>this.item=o),(0,C.z)(o=>(this.itemForm=this.formBuilder.group({_id:[this.item._id],_rev:[this.item._rev],dateOfCreation:[this.item.dateOfCreation],productId:[this.item.productId,[l.kI.required,l.kI.minLength(3)]],productName:[this.item.productName,[l.kI.required,l.kI.minLength(3)]],productColor:[this.item.productColor,[l.kI.required,l.kI.minLength(3)]],factoryInfoId:[this.item.factoryInfoId,[l.kI.required]],checklist:this.formBuilder.array(this.item.checklist.map(e=>this.formBuilder.group({checklistItemId:[e.checklistItemId],comment:[e.comment],order:[e.order],pointImages:this.formBuilder.array(e.pointImages.map(r=>this.formBuilder.group({selected:!1,...r}))),content:[e.content],isChecked:[e.isChecked]}))),images:this.formBuilder.array(this.item.images.map(e=>this.formBuilder.group({selected:!1,...e}))),comment:[this.item.comment],dateOfDelivery:[this.item.dateOfDelivery]}),this.reportService.getFactories())),(0,R.b)(o=>this.factoryItems=o),(0,O.P)()).subscribe({next:o=>{console.log("init success"),this.loading=!1},error:o=>{console.error(o),this.loading=!1}})}compareChecklist(o,e){let r=o.map(m=>({order:m.order,_id:m.checklistItemId,content:m.content})),i=e.map(m=>({order:m.order,_id:m._id,content:m.content}));const s=(m,d)=>m._id===d._id,c=(m,d,gt)=>m.filter(ft=>!d.some(It=>gt(ft,It))),p=c(r,i,s),u=c(i,r,s),F=c(r.filter(m=>!p.some(d=>d._id===m._id)&&!u.some(d=>d._id===m._id)),i.filter(m=>!p.some(d=>d._id===m._id)&&!u.some(d=>d._id===m._id)),(m,d)=>m._id===d._id&&m.content===d.content);let I=[];return I=I.concat(p.map(m=>({checkListItem:m,reason:f.REMOVED}))),I=I.concat(u.map(m=>({checkListItem:m,reason:f.ADDED}))),I=I.concat(F.map(m=>({checkListItem:m,reason:f.CHANGED}))),I}updateChecklist(o,e,r){let i=[...o];return e.forEach(s=>{switch(s.reason){case f.ADDED:i.push(M.Create({...s.checkListItem}));break;case f.REMOVED:break;case f.CHANGED:let c=i.find(u=>s.checkListItem._id===u.checklistItemId),p=r.find(u=>s.checkListItem._id===u._id);c&&(c.content=p.content)}}),i}get images(){return this.itemForm.get("images")}get checklistItemFormGroups(){return this.itemForm.get("checklist").controls.map(e=>e)}getFromFormGroup(){return this.itemForm.getRawValue()}preview(){let o=this.getFromFormGroup();this.reportService.updateReport(o).pipe((0,O.P)()).subscribe({next:e=>{this.router.navigate(["/reports/preview",o._id])},error:e=>console.error(e)})}saveReport(){let o=this.getFromFormGroup();this.reportService.updateReport(o).pipe((0,O.P)(),(0,Z.U)(e=>e)).subscribe()}static#t=this.\u0275fac=function(e){return new(e||N)(t.Y36(l.qu),t.Y36(E.sK),t.Y36(w.Yd),t.Y36(v.F0),t.Y36(A.uw),t.Y36(v.gz),t.Y36(w.rM))};static#e=this.\u0275cmp=t.Xpm({type:N,selectors:[["app-prepare-report"]],decls:6,vars:6,consts:[[4,"ngIf"],[1,"an-flex","an-flex-direction-column",3,"formGroup"],["matInput","","formControlName","productName",3,"placeholder"],["matInput","","formControlName","productColor",3,"placeholder"],["matInput","","formControlName","productId",3,"placeholder"],["formControlName","factoryInfoId",3,"placeholder"],[3,"value",4,"ngFor","ngForOf"],[2,"display","flex","flex-direction","column","gap","5px",3,"formGroup"],[4,"ngFor","ngForOf"],[2,"margin-top","5px"],["imagesFormArrayName","images",3,"imagesFormArray","parentImagesFormGroup"],[2,"width","100%"],["matInput","","formControlName","comment",3,"placeholder"],["mat-fab","","color","primary",1,"mat-fab-bottom-right-second",3,"disabled","click"],["mat-fab","","color","primary",1,"mat-fab-bottom-right",3,"disabled","click"],[3,"value"],[3,"checklistItemFormGroup"]],template:function(e,r){1&e&&(t.TgZ(0,"h1"),t._uU(1),t.ALo(2,"translate"),t.qZA(),t.YNc(3,rt,1,0,"mat-spinner",0),t.YNc(4,st,44,38,"div",0),t.YNc(5,at,3,0,"div",0)),2&e&&(t.xp6(1),t.Oqu(t.lcZ(2,4,"PREPARE_REPORT.TITLE")),t.xp6(2),t.Q6J("ngIf",r.loading),t.xp6(1),t.Q6J("ngIf",!r.loading&&r.item),t.xp6(1),t.Q6J("ngIf",!r.item&&!r.loading))},dependencies:[h.sg,h.O5,y.cs,g.a8,g.dn,g.dk,U.Hw,S.Nt,k.KE,k.hX,z.Ou,Y.gD,H.ey,l._Y,l.Fj,l.JJ,l.JL,l.sg,l.u,x,P,E.X$]})}var j=a(8580),ct=a(6709),lt=a(4633);function mt(n,o){if(1&n&&(t.TgZ(0,"mat-option",15),t._uU(1),t.qZA()),2&n){const e=o.$implicit;t.Q6J("value",e._id),t.xp6(1),t.hij(" ",e.shortName,"")}}function pt(n,o){if(1&n){const e=t.EpF();t.TgZ(0,"div",16),t.NdJ("click",function(i){const c=t.CHM(e).$implicit,p=t.oxw();return t.KtG(p.preview(i,c._id))}),t.TgZ(1,"div",17)(2,"span"),t._uU(3),t.qZA(),t.TgZ(4,"span"),t._uU(5),t.qZA(),t.TgZ(6,"span"),t._uU(7),t.ALo(8,"date"),t.qZA()(),t.TgZ(9,"div",18)(10,"mat-icon",19),t.NdJ("click",function(i){const c=t.CHM(e).$implicit,p=t.oxw();return t.KtG(p.prepare(i,c._id))}),t._uU(11,"edit"),t.qZA()()()}if(2&n){const e=o.$implicit,r=t.oxw();let i;t.xp6(3),t.lnq("",e.productName," (",e.productId,"), ",e.productColor,""),t.xp6(2),t.AsE("",null==(i=r.selectFactoryInfoConfig(e.factoryInfoId))?null:i.shortName," - ",null==(i=r.selectFactoryInfoConfig(e.factoryInfoId))?null:i.name,""),t.xp6(2),t.Oqu(t.xi3(8,6,e.dateOfCreation,"YYYY-MM-d, H:mm:ss"))}}const dt=function(){return["prepare"]};class L{constructor(o,e){this.reportService=o,this.router=e,this.loadFactoryWithNoActive=!1,this.factoryItems=[],this.items=[],this.productIdFilter=""}ngOnInit(){this.reloadFactories(!1).pipe((0,C.z)(o=>this.reloadReports()),(0,O.P)()).subscribe()}selectFactoryInfoConfig(o){return this.factoryItems.find(e=>e._id===o)}reloadReports(){return this.reportService.getReports(!0).pipe((0,R.b)(o=>this.items=o),(0,Z.U)(o=>!0))}filter(){}clearFilter(){}reloadFactories(o){return this.reportService.getFactories().pipe((0,R.b)(e=>this.factoryItems=e),(0,Z.U)(e=>!0))}preview(o,e){this.router.navigate(["/reports/preview",e])}prepare(o,e){o.stopPropagation(),this.router.navigate(["/reports/prepare",e])}static#t=this.\u0275fac=function(e){return new(e||L)(t.Y36(w.rM),t.Y36(v.F0))};static#e=this.\u0275cmp=t.Xpm({type:L,selectors:[["app-reports"]],decls:40,vars:30,consts:[["role","button","tabindex","0",1,"example-accordion-item"],["accordionItem","cdkAccordionItem"],[1,"example-accordion-item-header",3,"click"],[1,"example-accordion-item-description"],["role","region"],["appearance","outline",2,"width","100%"],["matInput","","type","text","name","value",3,"ngModel","ngModelChange"],["multiple","",3,"placeholder"],[3,"value",4,"ngFor","ngForOf"],[3,"checked","change"],[2,"margin-left","auto"],["mat-button","","color","secondary",3,"click"],["mat-raised-button","","color","primary",3,"click"],["class","an-list-item",3,"click",4,"ngFor","ngForOf"],["mat-fab","","color","primary",1,"mat-fab-bottom-right",3,"routerLink"],[3,"value"],[1,"an-list-item",3,"click"],[1,"an-list-item-des"],[1,"an-list-item-actions"],[3,"click"]],template:function(e,r){if(1&e){const i=t.EpF();t.TgZ(0,"div")(1,"h1"),t._uU(2),t.ALo(3,"translate"),t.qZA(),t.TgZ(4,"cdk-accordion")(5,"cdk-accordion-item",0,1)(7,"div",2),t.NdJ("click",function(){t.CHM(i);const c=t.MAs(6);return t.KtG(c.toggle())}),t.TgZ(8,"h4"),t._uU(9),t.ALo(10,"translate"),t.qZA(),t.TgZ(11,"span",3)(12,"mat-icon"),t._uU(13,"filter_alt"),t.qZA()()(),t.TgZ(14,"mat-card",4)(15,"mat-card-content")(16,"mat-form-field",5)(17,"mat-label"),t._uU(18),t.ALo(19,"translate"),t.qZA(),t.TgZ(20,"input",6),t.NdJ("ngModelChange",function(c){return r.productIdFilter=c}),t.qZA()(),t.TgZ(21,"mat-form-field",5)(22,"mat-select",7),t.ALo(23,"translate"),t.YNc(24,mt,2,2,"mat-option",8),t.qZA()(),t.TgZ(25,"mat-checkbox",9),t.NdJ("change",function(c){return r.reloadFactories(c.checked)}),t._uU(26),t.ALo(27,"translate"),t.qZA()(),t.TgZ(28,"mat-card-actions",10)(29,"button",11),t.NdJ("click",function(){return r.filter()}),t._uU(30),t.ALo(31,"translate"),t.qZA(),t.TgZ(32,"button",12),t.NdJ("click",function(){return r.clearFilter()}),t._uU(33),t.ALo(34,"translate"),t.qZA()()()()(),t.TgZ(35,"mat-list"),t.YNc(36,pt,12,9,"div",13),t.qZA(),t.TgZ(37,"button",14)(38,"mat-icon"),t._uU(39,"add"),t.qZA()()()}if(2&e){const i=t.MAs(6);t.xp6(2),t.Oqu(t.lcZ(3,15,"REPORTS.TITLE")),t.xp6(3),t.uIk("aria-expanded",i.expanded),t.xp6(4),t.Oqu(t.lcZ(10,17,"REPORTS.FILTER")),t.xp6(5),t.Udp("display",i.expanded?"":"none"),t.xp6(4),t.Oqu(t.lcZ(19,19,"ITEM.REPORT.PRODUCT_ID")),t.xp6(2),t.Q6J("ngModel",r.productIdFilter),t.xp6(2),t.s9C("placeholder",t.lcZ(23,21,"REPORTS.FILTER_BY_FACTORIES")),t.xp6(2),t.Q6J("ngForOf",r.factoryItems),t.xp6(1),t.Q6J("checked",r.loadFactoryWithNoActive),t.xp6(1),t.hij(" ",t.lcZ(27,23,"REPORTS.LOAD_NOACTIVE_FACTORIES")," "),t.xp6(4),t.Oqu(t.lcZ(31,25,"COMMON.CLEAR_FILTER")),t.xp6(3),t.Oqu(t.lcZ(34,27,"COMMON.FILTER")),t.xp6(3),t.Q6J("ngForOf",r.items),t.xp6(1),t.Q6J("routerLink",t.DdM(29,dt))}},dependencies:[h.sg,v.rH,j.xI,j.dD,y.lW,y.cs,g.a8,g.hq,g.dn,ct.oG,U.Hw,S.Nt,k.KE,k.hX,lt.i$,Y.gD,H.ey,l.Fj,l.JJ,l.On,h.uU,E.X$],styles:[".filter-select[_ngcontent-%COMP%]{background-color:#fff;color:#000;border:1px solid #666666}.example-accordion-item-header[_ngcontent-%COMP%]{display:flex;align-content:center;justify-content:space-between}"]})}const ut=[{path:"",component:L},{path:"prepare/:id",component:N},{path:"prepare",pathMatch:"full",component:N},{path:"preview",loadChildren:()=>Promise.all([a.e(592),a.e(992)]).then(a.bind(a,5992)).then(n=>n.PreviewReportModule)}];class J{static#t=this.\u0275fac=function(e){return new(e||J)};static#e=this.\u0275mod=t.oAB({type:J});static#o=this.\u0275inj=t.cJS({imports:[v.Bz.forChild(ut),v.Bz]})}var ht=a(1608);class D{static#t=this.\u0275fac=function(e){return new(e||D)};static#e=this.\u0275mod=t.oAB({type:D});static#o=this.\u0275inj=t.cJS({imports:[h.ez,J,ht.m]})}}}]);