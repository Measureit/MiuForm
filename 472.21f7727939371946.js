"use strict";(self.webpackChunkmiuform=self.webpackChunkmiuform||[]).push([[472],{472:(X,y,n)=>{n.r(y),n.d(y,{ReportsModule:()=>I});var f=n(6895),u=n(9132),a=n(4006),L=n(7188),h=n(590),g=n(4004),_=n(5577),t=n(4650),J=n(1481),A=n(577),O=n(4859),F=n(7392),U=n(4144),Z=n(9549),P=n(4385),E=n(3238),M=n(4463);function w(c,o){if(1&c&&(t.TgZ(0,"mat-option",15),t._uU(1),t.qZA()),2&c){const e=o.$implicit;t.Q6J("value",e._id),t.xp6(1),t.AsE(" ",e.shortName,"-",e.name,"")}}function q(c,o){if(1&c&&(t.TgZ(0,"div",16)(1,"div",17),t._UZ(2,"img",18),t.qZA()()),2&c){const e=o.$implicit,i=o.index,r=t.oxw(2);t.xp6(1),t.Q6J("formGroupName",i),t.xp6(1),t.Q6J("src",r.blobToSrc(e.get("blob").value),t.LSH)}}function Y(c,o){if(1&c){const e=t.EpF();t.TgZ(0,"div")(1,"p"),t._uU(2),t.qZA(),t.TgZ(3,"form",1)(4,"mat-form-field")(5,"mat-label"),t._uU(6),t.ALo(7,"translate"),t.qZA(),t._UZ(8,"input",2),t.ALo(9,"translate"),t.qZA(),t.TgZ(10,"mat-form-field")(11,"mat-label"),t._uU(12),t.ALo(13,"translate"),t.qZA(),t._UZ(14,"input",3),t.ALo(15,"translate"),t.qZA(),t.TgZ(16,"mat-form-field")(17,"mat-label"),t._uU(18),t.ALo(19,"translate"),t.qZA(),t._UZ(20,"input",4),t.ALo(21,"translate"),t.qZA(),t.TgZ(22,"mat-form-field")(23,"mat-select",5),t.ALo(24,"translate"),t.YNc(25,w,2,3,"mat-option",6),t.qZA()(),t.TgZ(26,"div",7)(27,"button",8),t.NdJ("click",function(){t.CHM(e);const r=t.MAs(31);return t.KtG(r.click())}),t.TgZ(28,"mat-icon"),t._uU(29,"library_add"),t.qZA(),t.TgZ(30,"input",9,10),t.NdJ("change",function(r){t.CHM(e);const l=t.oxw();return t.KtG(l.onFileInput(r))}),t.qZA()(),t.TgZ(32,"button",8),t.NdJ("click",function(){t.CHM(e);const r=t.MAs(31);return t.KtG(r.click())}),t.TgZ(33,"mat-icon"),t._uU(34,"delete"),t.qZA()(),t.TgZ(35,"button",8),t.NdJ("click",function(){t.CHM(e);const r=t.MAs(31);return t.KtG(r.click())}),t.TgZ(36,"mat-icon"),t._uU(37,"done_all"),t.qZA()(),t.TgZ(38,"button",8),t.NdJ("click",function(){t.CHM(e);const r=t.MAs(31);return t.KtG(r.click())}),t.TgZ(39,"mat-icon"),t._uU(40,"remove_done"),t.qZA()()(),t.TgZ(41,"div",11),t.YNc(42,q,3,2,"div",12),t.qZA()(),t.TgZ(43,"button",13),t.NdJ("click",function(){t.CHM(e);const r=t.oxw();return t.KtG(r.saveReport())}),t.TgZ(44,"mat-icon"),t._uU(45,"save"),t.qZA()(),t.TgZ(46,"button",14),t.NdJ("click",function(){t.CHM(e);const r=t.oxw();return t.KtG(r.preview())}),t.TgZ(47,"mat-icon"),t._uU(48,"rebase_edit"),t.qZA()()()}if(2&c){const e=t.oxw();t.xp6(2),t.Oqu(e.item._id),t.xp6(1),t.Q6J("formGroup",e.itemForm),t.xp6(3),t.Oqu(t.lcZ(7,11,"ITEM.REPORT.PRODUCT_NAME")),t.xp6(2),t.s9C("placeholder",t.lcZ(9,13,"ITEM.REPORT.PRODUCT_NAME")),t.xp6(4),t.Oqu(t.lcZ(13,15,"ITEM.REPORT.PRODUCT_COLOR")),t.xp6(2),t.s9C("placeholder",t.lcZ(15,17,"ITEM.REPORT.PRODUCT_COLOR")),t.xp6(4),t.Oqu(t.lcZ(19,19,"ITEM.REPORT.PRODUCT_ID")),t.xp6(2),t.s9C("placeholder",t.lcZ(21,21,"ITEM.REPORT.PRODUCT_ID")),t.xp6(3),t.s9C("placeholder",t.lcZ(24,23,"ITEM.REPORT.FACTORY")),t.xp6(2),t.Q6J("ngForOf",e.factoryItems),t.xp6(17),t.Q6J("ngForOf",null==e.images?null:e.images.controls)}}function G(c,o){1&c&&(t.TgZ(0,"div")(1,"p"),t._uU(2,"Raport nie istnieje."),t.qZA()())}class T{constructor(o,e,i,r,l,s){this.formBuilder=o,this.domSanitizer=e,this.logger=i,this.router=r,this.activatedRoute=l,this.reportService=s,this.item=void 0,this.factoryItems=[],this.onFileInput=p=>{console.log("aaa"),p.target.files&&p.target.files.length>0&&(0,L.$)(Array.from(p.target.files).map(m=>this.resizeImage(m,1200,1200))).subscribe({next:m=>{console.log(m),m.forEach(d=>this.images.push(new a.cw({blob:new a.NI(d.blob),size:new a.NI(d.size)}))),console.log(this.images)},error:m=>{console.error(m)}})}}ngOnInit(){this.activatedRoute.params.pipe((0,h.P)(),(0,g.U)(o=>o.id),(0,_.z)(o=>(this.logger.debug(`prepare report for id: ${o}`),void 0!==o&&""!==o?this.reportService.getReport(o):this.reportService.createNewReport())),(0,h.P)(),(0,_.z)(o=>(this.item=o,this.itemForm=this.formBuilder.group({_id:[this.item._id],_rev:[this.item._rev],dateOfCreation:[this.item.dateOfCreation],productId:[this.item.productId,[a.kI.required,a.kI.minLength(3)]],productName:[this.item.productName,[a.kI.required,a.kI.minLength(3)]],productColor:[this.item.productColor,[a.kI.required,a.kI.minLength(3)]],factoryInfoId:[this.item.factoryInfoId,[a.kI.required]],checklist:this.formBuilder.array(this.item.checklist.map(e=>this.formBuilder.group({checklistItemId:[e.checklistItemId],comment:[e.comment],pointImages:this.formBuilder.array(e.pointImages.map(i=>this.formBuilder.group({...i}))),content:[e.content],isChecked:[e.isChecked]}))),images:this.formBuilder.array(this.item.images.map(e=>this.formBuilder.group({...e}))),reportPath:[this.item.reportPath],dateOfDelivery:[this.item.dateOfDelivery]}),this.reportService.getFactories(!1))),(0,h.P)(),(0,g.U)(o=>this.factoryItems=o)).subscribe()}getFromFormGroup(){return this.itemForm.getRawValue()}preview(){let o=this.getFromFormGroup();this.reportService.updateReport(o).pipe((0,h.P)()).subscribe({next:e=>{this.router.navigate(["/reports/preview",o._id])},error:e=>console.error(e)})}saveReport(){let o=this.getFromFormGroup();this.reportService.updateReport(o).pipe((0,h.P)(),(0,g.U)(e=>e)).subscribe()}get images(){return this.itemForm.get("images")}blobToSrc(o){return console.log("blobToSrc: "+o),this.domSanitizer.bypassSecurityTrustUrl(URL.createObjectURL(o))}getScale(o,e,i){if(o.width<=e&&o.height<=i)return{width:o.width,height:o.height};let r,l;return o.width>o.height?(l=o.height*(e/o.width),r=e):(r=o.width*(i/o.height),l=i),{width:r,height:l}}resizeImage(o,e,i){return new Promise((r,l)=>{let s=new Image;s.src=URL.createObjectURL(o),s.onload=()=>{let d,v,p=s.width,m=s.height;p<=e&&m<=i&&r({blob:o,size:{width:p,height:m}}),p>m?(v=m*(e/p),d=e):(d=p*(i/m),v=i);let x=document.createElement("canvas");x.width=d,x.height=v,x.getContext("2d").drawImage(s,0,0,d,v),x.toBlob(z=>{r({blob:z,size:{width:d,height:v}})},o.type)},s.onerror=l})}static#t=this.\u0275fac=function(e){return new(e||T)(t.Y36(a.qu),t.Y36(J.H7),t.Y36(A.Yd),t.Y36(u.F0),t.Y36(u.gz),t.Y36(A.rM))};static#e=this.\u0275cmp=t.Xpm({type:T,selectors:[["app-prepare-report"]],decls:5,vars:5,consts:[[4,"ngIf"],[1,"an-flex","an-flex-direction-column",3,"formGroup"],["matInput","","formControlName","productName",3,"placeholder"],["matInput","","formControlName","productColor",3,"placeholder"],["matInput","","formControlName","productId",3,"placeholder"],["formControlName","factoryInfoId",3,"placeholder"],[3,"value",4,"ngFor","ngForOf"],[2,"display","flex","flex-direction","row"],["mat-fab","",3,"click"],["type","file","accept","image/x-png,image/jpeg,image/gif","multiple","multiple",2,"display","none",3,"change"],["fileInput",""],[2,"display","flex","flex-direction","row","flex-flow","wrap"],["style","margin: 3px; border: 1px solid black","formArrayName","images",4,"ngFor","ngForOf"],["mat-fab","","color","primary",1,"mat-fab-bottom-right-second",3,"click"],["mat-fab","","color","primary",1,"mat-fab-bottom-right",3,"click"],[3,"value"],["formArrayName","images",2,"margin","3px","border","1px solid black"],[2,"width","200px","height","200px","display","flex","justify-content","center",3,"formGroupName"],[2,"display","block","max-width","200px","max-height","200px","width","auto","height","auto","margin","auto",3,"src"]],template:function(e,i){1&e&&(t.TgZ(0,"h1"),t._uU(1),t.ALo(2,"translate"),t.qZA(),t.YNc(3,Y,49,25,"div",0),t.YNc(4,G,3,0,"div",0)),2&e&&(t.xp6(1),t.Oqu(t.lcZ(2,3,"PREPARE_REPORT.TITLE")),t.xp6(2),t.Q6J("ngIf",i.item),t.xp6(1),t.Q6J("ngIf",!i.item))},dependencies:[f.sg,f.O5,O.cs,F.Hw,U.Nt,Z.KE,Z.hX,P.gD,E.ey,a._Y,a.Fj,a.JJ,a.JL,a.sg,a.u,a.x0,a.CE,M.X$]})}var N=n(8505),k=n(8580),b=n(3546),D=n(6709),S=n(4633);function B(c,o){if(1&c&&(t.TgZ(0,"mat-option",15),t._uU(1),t.qZA()),2&c){const e=o.$implicit;t.Q6J("value",e._id),t.xp6(1),t.AsE(" ",e.shortName,"-",e.name,"")}}function H(c,o){if(1&c){const e=t.EpF();t.TgZ(0,"div",16),t.NdJ("click",function(r){const s=t.CHM(e).$implicit,p=t.oxw();return t.KtG(p.preview(r,s._id))}),t.TgZ(1,"div",17)(2,"span"),t._uU(3),t.qZA(),t.TgZ(4,"span"),t._uU(5),t.qZA(),t.TgZ(6,"span"),t._uU(7),t.ALo(8,"date"),t.qZA()(),t.TgZ(9,"button",18),t.NdJ("click",function(r){const s=t.CHM(e).$implicit,p=t.oxw();return t.KtG(p.prepare(r,s._id))}),t.TgZ(10,"mat-icon"),t._uU(11,"edit"),t.qZA()()()}if(2&c){const e=o.$implicit,i=t.oxw();let r;t.xp6(3),t.Oqu(e.productId),t.xp6(2),t.AsE("",null==(r=i.selectFactoryInfoConfig(e.factoryInfoId))?null:r.shortName,"-",null==(r=i.selectFactoryInfoConfig(e.factoryInfoId))?null:r.name,""),t.xp6(2),t.Oqu(t.xi3(8,4,e.dateOfCreation,"YYYY-MM-d, H:mm:ss"))}}const Q=function(){return["prepare"]};class R{constructor(o,e){this.reportService=o,this.router=e,this.loadFactoryWithNoActive=!1,this.factoryItems=[],this.items=[],this.productIdFilter=""}ngOnInit(){this.reloadFactories(!1).pipe((0,_.z)(o=>this.reloadReports()),(0,h.P)()).subscribe()}selectFactoryInfoConfig(o){return this.factoryItems.find(e=>e._id===o)}reloadReports(){return this.reportService.getReports(!0).pipe((0,N.b)(o=>this.items=o),(0,g.U)(o=>!0))}filter(){}clearFilter(){}reloadFactories(o){return this.reportService.getFactories(o).pipe((0,N.b)(e=>this.factoryItems=e),(0,g.U)(e=>!0))}preview(o,e){this.router.navigate(["/reports/preview",e])}prepare(o,e){o.stopPropagation(),this.router.navigate(["/reports/prepare",e])}static#t=this.\u0275fac=function(e){return new(e||R)(t.Y36(A.rM),t.Y36(u.F0))};static#e=this.\u0275cmp=t.Xpm({type:R,selectors:[["app-reports"]],decls:40,vars:30,consts:[["role","button","tabindex","0",1,"example-accordion-item"],["accordionItem","cdkAccordionItem"],[1,"example-accordion-item-header",3,"click"],[1,"example-accordion-item-description"],["role","region"],["appearance","outline",2,"width","100%"],["matInput","","type","text","name","value",3,"ngModel","ngModelChange"],["multiple","",3,"placeholder"],[3,"value",4,"ngFor","ngForOf"],[3,"checked","change"],[2,"margin-left","auto"],["mat-button","","color","secondary",3,"click"],["mat-raised-button","","color","primary",3,"click"],["class","an-list-item",3,"click",4,"ngFor","ngForOf"],["mat-fab","","color","primary",1,"mat-fab-bottom-right",3,"routerLink"],[3,"value"],[1,"an-list-item",3,"click"],[1,"an-list-item-des"],[3,"click"]],template:function(e,i){if(1&e){const r=t.EpF();t.TgZ(0,"div")(1,"h1"),t._uU(2),t.ALo(3,"translate"),t.qZA(),t.TgZ(4,"cdk-accordion")(5,"cdk-accordion-item",0,1)(7,"div",2),t.NdJ("click",function(){t.CHM(r);const s=t.MAs(6);return t.KtG(s.toggle())}),t.TgZ(8,"h4"),t._uU(9),t.ALo(10,"translate"),t.qZA(),t.TgZ(11,"span",3)(12,"mat-icon"),t._uU(13,"filter_alt"),t.qZA()()(),t.TgZ(14,"mat-card",4)(15,"mat-card-content")(16,"mat-form-field",5)(17,"mat-label"),t._uU(18),t.ALo(19,"translate"),t.qZA(),t.TgZ(20,"input",6),t.NdJ("ngModelChange",function(s){return i.productIdFilter=s}),t.qZA()(),t.TgZ(21,"mat-form-field",5)(22,"mat-select",7),t.ALo(23,"translate"),t.YNc(24,B,2,3,"mat-option",8),t.qZA()(),t.TgZ(25,"mat-checkbox",9),t.NdJ("change",function(s){return i.reloadFactories(s.checked)}),t._uU(26),t.ALo(27,"translate"),t.qZA()(),t.TgZ(28,"mat-card-actions",10)(29,"button",11),t.NdJ("click",function(){return i.filter()}),t._uU(30),t.ALo(31,"translate"),t.qZA(),t.TgZ(32,"button",12),t.NdJ("click",function(){return i.clearFilter()}),t._uU(33),t.ALo(34,"translate"),t.qZA()()()()(),t.TgZ(35,"mat-list"),t.YNc(36,H,12,7,"div",13),t.qZA(),t.TgZ(37,"button",14)(38,"mat-icon"),t._uU(39,"add"),t.qZA()()()}if(2&e){const r=t.MAs(6);t.xp6(2),t.Oqu(t.lcZ(3,15,"REPORTS.TITLE")),t.xp6(3),t.uIk("aria-expanded",r.expanded),t.xp6(4),t.Oqu(t.lcZ(10,17,"REPORTS.FILTER")),t.xp6(5),t.Udp("display",r.expanded?"":"none"),t.xp6(4),t.Oqu(t.lcZ(19,19,"ITEM.REPORT.PRODUCT_ID")),t.xp6(2),t.Q6J("ngModel",i.productIdFilter),t.xp6(2),t.s9C("placeholder",t.lcZ(23,21,"REPORTS.FILTER_BY_FACTORIES")),t.xp6(2),t.Q6J("ngForOf",i.factoryItems),t.xp6(1),t.Q6J("checked",i.loadFactoryWithNoActive),t.xp6(1),t.hij(" ",t.lcZ(27,23,"REPORTS.LOAD_NOACTIVE_FACTORIES")," "),t.xp6(4),t.Oqu(t.lcZ(31,25,"COMMON.CLEAR_FILTER")),t.xp6(3),t.Oqu(t.lcZ(34,27,"COMMON.FILTER")),t.xp6(3),t.Q6J("ngForOf",i.items),t.xp6(1),t.Q6J("routerLink",t.DdM(29,Q))}},dependencies:[f.sg,u.rH,k.xI,k.dD,O.lW,O.cs,b.a8,b.hq,b.dn,D.oG,F.Hw,U.Nt,Z.KE,Z.hX,S.i$,P.gD,E.ey,a.Fj,a.JJ,a.On,f.uU,M.X$],styles:[".filter-select[_ngcontent-%COMP%]{background-color:#fff;color:#000;border:1px solid #666666}.example-accordion-item-header[_ngcontent-%COMP%]{display:flex;align-content:center;justify-content:space-between}"]})}const K=[{path:"",component:R},{path:"prepare/:id",component:T},{path:"prepare",pathMatch:"full",component:T},{path:"preview",loadChildren:()=>Promise.all([n.e(592),n.e(992)]).then(n.bind(n,5992)).then(c=>c.PreviewReportModule)}];class C{static#t=this.\u0275fac=function(e){return new(e||C)};static#e=this.\u0275mod=t.oAB({type:C});static#o=this.\u0275inj=t.cJS({imports:[u.Bz.forChild(K),u.Bz]})}var j=n(1608);class I{static#t=this.\u0275fac=function(e){return new(e||I)};static#e=this.\u0275mod=t.oAB({type:I});static#o=this.\u0275inj=t.cJS({imports:[f.ez,C,j.m]})}}}]);